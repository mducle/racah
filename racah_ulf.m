function ulf = racah_ulf(U,L,Up,Lp)
% Looks up the value of the racah function (UL|U'L'+f) from tables
% Tables from Racah IV, Phys. Rev. 76 (1949) 1352 for tableIV (t1,t2,t3)
% and from Wybourne, J. Chem. Phys. 36 (1961) 2295 for table IIb-c (t4,t5)

if isnumeric(L)
  L = racah_lconv(L);
end

if isnumeric(Lp)
  Lp = racah_lconv(Lp);
end

t1 = [0       -1        0        0        0        0        0;
      1        1       3/14    11/14    -5/27    -1/3    -13/27;
      0        1        0        0      10/21   -11/21      0;
      0        1        0        0      20/189   65/231 -182/297;
      0        1     -27/49   -22/49   -16/49    33/49      0;
      0        1      33/98   -65/98    55/147 -125/539   13/33;
      0        1        0        1        0       3/11     8/11;
      0        0     -22/49    27/49    33/49    16/49      0;
      0        0     -11/14     3/14   -55/126   -8/77    91/198;
      0        0      65/98    33/98    13/882  104/147    5/18;
      0        0        0        1      13/27   -16/33   -10/297;
      0        0        0        1        0      16/33   -17/33;
      0        0        0        1        0        0        1;
      0        0        0        0      11/21    10/21      0;
      0        0        0        0     143/378 -130/231   35/594;
      0        0        0        0      11/18     2/33   -65/198;
      0        0        0        0      26/63    18/77    35/99;
      0        0        0        0        0       8/11    -3/11;
      0        0        0        0        0      17/33    16/33;
      0        0        0        0        0        0        1];

t2 = [ [220     -539     -585        0        0        0] ./ 1344;
      [-270      147     -297     1078     1470    -1666] ./ 4928;
      [8910     8085      351   -14014        0        0] ./ 31360;
       [330      147     1287     1078    -1470        0] ./ 4312;
         [0    -1911     1485      220     4590    10098] ./ 18304;
       [375     1960    -1144     1911        0        0] ./ 5390;
       [-40       49      -65        0        0        0] ./ 154;
    [-74360   207025   226941   -51744    70560        0] ./ 630630;
     [-2535        0     1056    -3179     7260     1700] ./ 15730;
         [0        0     -192      968      -85     1615] ./ 2860;
         [0        0        0      -40     -285      247] ./ 572;
      [1156     -245     1287        0        0        0] ./ 2688;
       [-39        0       24       49        0        0] ./ 112;
      [1375     2450     -858     1617     1620        0] ./ 7920;
    [-42250  -207025     3971   261954      490   124950] ./ 640640;
         [0     1274     2750     1320     2125    -1683] ./ 9152;
         [0        0     -204     -136      605       95] ./ 1040;
         [0        0        0        0      -15      -49] ./ 64;
         [0        1        0        0        0        0] ./ 1;
      [-130      195      297       18        0        0] ./ 640;
     [18590     4225     -429   -23826    -4410        0] ./ 51480;
       [980    -2450     1078     -132      245    -1275] ./ 6160;
         [0     1105     9163    -2244    -4802      990] ./ 18304;
         [0        0        0      152     -147      -65] ./ 364;
         [0        0        0        0       -5       11] ./ 16];


t3 = [ [-54      -91      189     -156        0        0        0] ./ 490;
      [-330      910      126     -594     2184    -1785        0] ./ 5929;
         [0     -245    -1755    -2310    -2106    -4320   -11286] ./ 22022;
      [-578     1092      700      325        0        0        0] ./ 2695;
       [-55        0     -560     -715     -364        0        0] ./ 1694;
    [-83655   -87360   -56784    -3971   227500   171360        0] ./ 630630;
         [0    12740    -7644    18711    -7800    -8160        0] ./ 55055;
         [0        0   -16848       77   -27625    79860   -40755] ./ 165165;
         [0        0        0    -1785    -1989    -1140    12103] ./ 17017;
         [0       13        3        0        0        0        0] ./ 16;
       [429      -77      273      -33     -420        0        0] ./ 1232;
     [-3465    -9555     7203    27797     1300    -6120        0] ./ 55440;
         [0     -195    -4693     1232     2600     2720        0] ./ 11440;
         [0     5880      520    -6160    -1911    15680    -1881] ./ 32032;
         [0        0    33813    89012  -216580     8085   163020] ./ 510510;
         [0        0        0        0      153      960     2695] ./ 3808];

t = [ [t1;zeros(7,7)] [zeros(2,6);t2] [zeros(4,7);t3;zeros(7,7)] ];

t4 = [  [52       65      -11        0        0        0] ./ 128;
       [156      -26      110       60        0        0] ./ 352;
         [8       45       13        0        0        0] ./ 66;
        [26        0      -16       54        0        0] ./ 96;
      [9295    -8450     7722      -33     8820        0] ./ 34320;
    [258570    71825    22627    54978    74970    66150] ./ 549120;
   [-745290  1002001  5498339   411906  -533610  -265302] ./ 8456448;
         [0 21352820 -3613555 744244672 -226175632 78355136] ./ 1073741824;
%         [0     2080     -352     1056     -153      935] ./ 4576;
	 [0  0.67614 -0.11442 -0.028022 0.044056 0.13736] ./ 1;
%         [0     4420     -748    -8976     4050      110] ./ 18304;
	 [0        0 0.034372 -0.50927 -0.18955	 0.26681] ./ 1;
%         [0        0   341164   -55176     4845   159375] ./ 560560;
	 [0        0  0.70234   0.0215    0.199 0.077162] ./ 1;
%         [0        0      816     2754     2420     -380] ./ 6370;
         [0        0        0      513       98      390] ./ 1001;
         [0        0        0        0       49      -15] ./ 64;
         [0        0        0        0       11        5] ./ 16;
         [0        0        0        0        0        1] ./ 1];


t5 = [   [0       -3       13        0        0        0        0] ./ 16;
      [-936    -1029      -91     1024        0        0        0] ./ 3080;
       [-99        0      700    -1287      455        0        0] ./ 2541;
      [1287     2079      -91      -99      140        0        0] ./ 3696;
    [-83655    66885    31941     5819    -9100    42840        0] ./ 240240;
         [0    -3315   -26741   -20944        0   -17640        0] ./ 68640;
         [0   238875    31213    -1232   632736  -153000        0] ./ 1057056;
	 [0 -0.35979 0.40584 0.0076923 -0.20576 0.014386 -0.0065247] ./ 1;
%         [0   -51450   402038   137984    -1365     9072  -182875] ./ 784784;
	 [0 0.062413  0.13799  0.26154  0.16558 0.00095199 -0.37153] ./ 1;
%         [0  9516192  -841568  2492336  9862125  -100800 -3869635] ./ 26682656;
	 [0        0  0.28021 -0.62852 -0.082414 0.0088109 -4.9822e-05] ./ 1;
%        -[0 0 -118697579 616876876 1092831740 730219875 349489140] ./ 2908115210;
	 [0        0 -0.021683 0.00050167 -0.30417 -0.48925 -0.18439] ./ 1;
%      -[0 0 2560049856 -4088054124 105884415 2421693120 630194565] ./ 9805876080;
         [0        0        0   -81396    62985   118336     9555] ./ 272272;
         [0        0        0        0     -255      256      -33] ./ 544;
         [0        0        0        0        0      -11       23] ./ 34;
         [0        0        0        0        0        0       -1] ./ 1];

% T6 is not complete! It has been partially reassembled from the tabulated cfp listed in 
%   C.W. Neilson and G.F. Koster, 1963.
% U'=(22) S        D        G        H        I        L        N              U=(31)
t6 = [   [0       27       -8        0        0        0        0] ./ 35;    % P
         [0     -720     -841     -364        0        0        0] ./ 1925;  % D
      [4455    -3432    -1664     1386    -1768        0        0] ./ 12705; % F
         [0       33    -1444        0      833        0        0] ./ 2310;  % F'
         [0     1485     -972    -4928    -4165        0        0] ./ 11550; % G
         [0     6630    62866   -34034   -28665    17955        0] ./ 150150;% H
         [0   133770      686    82654   -69615   -43605        0] ./ 330330;% H'
         [0        0     5600     -572    -4641   -14212        0] ./ 25025; % I
         [0        0    -2975   -19448    -2184      418        0] ./ 25025  % I'
         [0        0 8075/36179 -323/1771 14592/3548325 2583552/10935925 -144669/408595] ./ 1;     % K
         [0        0   -17472   -50193   244944   -38896    -2695] ./ 354200;% K'
         [0        0        0  -171/3080 114/935 -5046/7315 -343/2584] ./ 1;     % L
         [0        0        0        0   -21/85   -12/95 1012/1615] ./ 1;     % M
         [0        0        0        0        0       49       46] ./ 95;    % N
         [0        0        0        0        0       -1       18] ./ 19];   % O
% U'=(22) S        D        G        H        I        L        N              U=(21)
t7 = [   [0   -13/77  208/385   -16/55        0        0        0] ./ 1;     % D
     [-1408    -2145    -1040    -6160    -1105        0        0] ./ 11858; % F
         [0     1485      -48    -1232     4165        0        0] ./ 6930;  % G
         [0    -4095   121296    -6864    46410  -206720        0] ./ 385385;% H
         [0        0     1008      572     4459     8976     8580] ./ 23595; % K
         [0        0        0     1020      315    -1360     6468] ./ 9163]; % L

t = [ [t [zeros(7,7);t7;zeros(14,7)]]; [zeros(15,7) t4 t5 t6] ];

acry1 = [0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0;
        -0.2873    0.38739  -0.23972  -0.35832   0.4063   -0.59228   0.25624   0         0;
         0.27147   0.13366   0.4805    0         0.32741   0.26382   0.2511   -0.11183  -0.65208;
         0.098489  0.24246  -0.22776   0.20951   0.27603  -0.13059  -0.51875  -0.040572 -0.23657;
         0        -0.16198   0         0.34816   0.016322  0.18413   0.12843  -0.52667   0.1059;
         0         0         0         0        -0.2285    0.18413  -0.12518   0.24863  -0.11371;
         0         0         0         0         0        -0.16247   0.08291   0.13746   0.1886;
         0         0.45426  -0.19245   0.57534   0.65238   0         0         0         0;
         -0.18094  0.3118    0         0.47871  -0.38188  -0.17584   0.38036   0.52175  -0.21731;
         -0.33217 -0.081776 -0.29545   0.088328  0.23274   0.44044  -0.12126   0.4887    0.28496;
         0        -0.24813  -0.36237  -0.083333 -0.089855 -0.35258  -0.021791 -0.060858 -0.35486;
         0         0        -0.1982   -0.091157 -0.10336   0        -0.45426  -0.28953   0.25973;
         0         0         0         0        -0.20878  -0.27709  -0.20795  -0.07127  -0.018334;
         0         0         0         0         0         0         0         0.042647  0.32181;
         0         0        -1         0         0         0         0         0         0;
        -0.43425  -0.39036   0.39252  -0.090267  0.30706  -0.19894  -0.60246   0         0;
         0.17618  -0.31446   0.20372   0.44506  -0.18516  -0.4566   -0.032157  0.36289  -0.2645;
         0         0.18713   0.16817   0         0.37712  -0.30388   0.31928   0.10491   0.6117;
         0         0         0.17472  -0.28126  -0.31892   0.25654   0.26954  -0.27487  -0.18856;
         0         0         0         0         0        -0.17755   0.18654  -0.42063   0.072138;
         0         0         0         0         0         0         0         0         0;
         0         0.51427   0.74536   0.23997  -0.34984   0         0         0         0;
        -0.39835  -0.08481   0.028427  0.58181   0.48181   0.28815   0.42384   0         0;
         0.48795  -0.024025 -0.56138   0        -0.058849  0.4742    0.45134   0.020101  0.11721;
         0.1571   -0.49172   0         0.29689   0.35863   0.15267  -0.33025   0.61942  -0.026954;
         0.20198   0.35912   0.0519   -0.31628  -0.28828   0.33815  -0.33823   0.12019  -0.51212;
         0        -0.19427   0.37828   0.12179  -0.30587   0.45466  -0.39581   0.15247   0.30071;
         0        -0.28575   0.36004  -0.26345   0.30594  -0.39581  -0.30789  -0.089522  0.096158;
         0         0        -0.01475  -0.45453   0.1      -0.14025   0.082348 -0.34641   0.25128;
         0         0        -0.086006  0.019779 -0.42611  -0.27661  -0.088452  0.25128   0.70277;
         0         0         0         0         0.11063  -0.24936   0.026934  0.47099   0.015471;
         0         0         0         0         -0.2667   0.035818  0.50361  -0.11487   0.36358;
         0         0         0         0         0        -0.3086    0.081058  0.29701  -0.10971;
         0         0         0         0         0         0         0         0.35774   0.02231;
         0         0         0         0         0         0         0         0         0;
         0         0         0         0         0         0         0         0         0];

acry2 = [0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
        -0.13928  -0.62959   0         0         0         0;
        -0.48493   0.099639 -0.51788   0         0         0;
        -0.25335   0.25959  -0.19384   0.57306  -0.5709    0;
        -0.28234  -0.15184   0.36322   0.29783   0.36155  -0.67686;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
        -0.43619   0.12134   0         0         0         0;
        -0.59091   0.016695  0.43385   0         0         0;
         0.19683   0.37814   0.35106   0.52831   0         0;
         0.059913 -0.44646  -0.44797   0.49279   0.42957   0;
        -0.0040031 -0.24353 -0.1131   -0.15721  -0.55191  -0.70227;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
        -0.3893    0.18301   0         0         0         0;
        -0.31831  -0.28058   0.18697   0         0         0;
        -0.043968 -0.57016   0.25487   0.38355   0         0;
        -0.29142   0.19868  -0.53013   0.23983   0.50949   0.17032;
         0.32099   0.047055 -0.20923  -0.4806    0.44415  -0.65017;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
         0         0         0         0         0         0;
        -0.14282   0.34431   0         0         0         0;
        -0.29119   0.041826  0.38364   0         0         0;
         0.031452  0.58809  -0.10077   0         0         0;
        -0.50592   0.12339   0.33964  -0.43249   0         0;
        -0.016619 -0.39055  -0.12546  -0.026972  0         0;
        -0.094833  0.28092  -0.66783  -0.40656   0.059898  0;
         0.28092   0.53968  -0.057737  0.26475   0.29152   0;
         0.62732   0.054235  0.2052    0.20408   0.47967   0.29604;
        -0.36124   0.23524  -0.19304  -0.40532   0.58122  -0.38253;
        -0.050623 -0.24638   0.43158  -0.55285   0.42283   0.5158;
         0         0        -0.25451  -0.34768  -0.49286   0.75593];

t = [t acry1.^2.*sign(acry1) acry2.^2.*sign(acry2)];

if U==[0 0]
  if L == 'S'; i = 1; else i = 0; end
elseif U==[1 0]
  if L == 'F'; i = 2; else i = 0; end
elseif U==[1 1]
  if L == 'P'; i = 3; elseif L == 'H'; i = 4; else; i = 0; end
elseif U==[2 0] 
  switch L
    case 'D'; i = 5;
    case 'G'; i = 6;
    case 'I'; i = 7;
  otherwise
    i = 0;
  end
elseif U==[2 1]
  switch L
    case 'D'; i = 8;
    case 'F'; i = 9;
    case 'G'; i = 10;
    case 'H'; i = 11;
    case 'K'; i = 12;
    case 'L'; i = 13;
  otherwise
    i = 0;
  end
elseif U==[3 0]
  switch L
    case 'P'; i = 14;
    case 'F'; i = 15;
    case 'G'; i = 16;
    case 'H'; i = 17;
    case 'I'; i = 18;
    case 'K'; i = 19;
    case 'M'; i = 20;
  otherwise
    i = 0;
  end
elseif U==[2 2]
  switch L
    case 'S'; i = 21;
    case 'D'; i = 22;
    case 'G'; i = 23;
    case 'H'; i = 24;
    case 'I'; i = 25;
    case 'L'; i = 26;
    case 'N'; i = 27;
  otherwise
    i = 0;
  end
elseif U==[3 1]         % Table IIbc from Uybourne
  switch L
    case 'P';  i = 28;
    case 'D';  i = 29;
    case 'F';  i = 30;
    case 'Fp'; i = 31;
    case 'G';  i = 32;
    case 'H';  i = 33;
    case 'Hp'; i = 34;
    case 'I';  i = 35;
    case 'Ip'; i = 36;
    case 'K';  i = 37;
    case 'Kp'; i = 38;
    case 'L';  i = 39;
    case 'M';  i = 40;
    case 'N';  i = 41;
    case 'O';  i = 42;
  otherwise
    i = 0;
  end
else
  i = 0;
end

if Up==[0 0]
  if Lp == 'S'; j = 1; else j = 0; end
elseif Up==[1 0]
  if Lp == 'F'; j = 2; else j = 0; end
elseif Up==[1 1]
  if Lp == 'P'; j = 3; elseif Lp == 'H'; j = 4; else; j = 0; end
elseif Up==[2 0] 
  switch Lp
    case 'D'; j = 5;
    case 'G'; j = 6;
    case 'I'; j = 7;
  otherwise
    j = 0;
  end
elseif Up==[2 1]
  switch Lp
    case 'D'; j = 8;
    case 'F'; j = 9;
    case 'G'; j = 10;
    case 'H'; j = 11;
    case 'K'; j = 12;
    case 'L'; j = 13;
  otherwise
    j = 0;
  end
elseif Up==[3 0]
  switch Lp
    case 'P'; j = 14;
    case 'F'; j = 15;
    case 'G'; j = 16;
    case 'H'; j = 17;
    case 'I'; j = 18;
    case 'K'; j = 19;
    case 'M'; j = 20;
  otherwise
    j = 0;
  end
elseif Up==[2 2]
  switch Lp
    case 'S'; j = 21;
    case 'D'; j = 22;
    case 'G'; j = 23;
    case 'H'; j = 24;
    case 'I'; j = 25;
    case 'L'; j = 26;
    case 'N'; j = 27;
  otherwise
    j = 0;
  end
elseif Up==[3 1]         % Table IIbc from Uybourne
  switch Lp
    case 'P';  j = 28;
    case 'D';  j = 29;
    case 'F';  j = 30;
    case 'Fp'; j = 31;
    case 'G';  j = 32;
    case 'H';  j = 33;
    case 'Hp'; j = 34;
    case 'I';  j = 35;
    case 'Ip'; j = 36;
    case 'K';  j = 37;
    case 'Kp'; j = 38;
    case 'L';  j = 39;
    case 'M';  j = 40;
    case 'N';  j = 41;
    case 'O';  j = 42;
  otherwise
    j = 0;
  end
else
  j = 0;
end

if i~=0 & j~=0
  ulf = real(sqrt(t(i,j))) - imag(sqrt(t(i,j)));
else
  ulf = 0;
end
